---
title: D3学习笔记
date: 2018-03-30 21:31:33
tags:
---

## 第一章 简介

D3: Data-Driven Documents

几个有用的网站：

 - [D3 gallery](https://github.com/mbostock/d3/wiki/Gallery)，这里有不少有趣的例子，可以帮你在线查找 D3 的使用方法，有各种各样的图表、特定的技术，还有一些跟其他工具一起实现的示例。
 - [BioVisualize](http://biovisualize.github.io/d3visualization)，算是一个分门别类的D3 gallery，可以帮你快速地在线查找你想要的例子。
 - [D3 教程](https://github.com/mbostock/d3/wiki/Tutorials)，有很多朋友不断更新提供的教程、讨论和文档，给你细致地演示了D3的使用方法。

 - [D3 插件](https://github.com/d3/d3-plugins)，可能有些你需要的功能是D3没有的。在你自己实践之前，先查查D3的插件库，它提供了各种常用的、不常用的功能。

- [D3 API](https://github.com/mbostock/d3/wiki/API-Reference)是很不错的文档。这里你能找到D3所提供的全部功能、属性的详细说明。

- [Mike Bostok's Blocks](http://bl.ocks.org/mbostock)是个D3示例站点，作者是Mike Bostock，这个站点里有很多有趣的例子。

- [JS Bin](http://jsbin.com/ugacud/1/edit)是个在线的D3测试、实验环境。你可以很容易地通过该工具跟其他人分享一些简单的代码。

- [JS Fiddle](http://jsfiddle.net/qAHC2/)跟JS Bin差不多，也是一个在线JavaScript代码分享平台。

- [CSS四级选择器](https://css4-selectors.com/browser-selector-test) 

## 第二章 选择器

### 常用的CSS3选择器

- #foo
- .foo
- foo
- [foo=goo]  选中属性foo的值为goo的元素
- foo goo  选中foo元素的子元素goo
- foo#goo   
- foo.goo
- foo:first-chind
- foo:nth-child(n)


### 1.选择单个元素

```html
<p id="target"><p>
```
```javascript
d3.select("p#target")
  .text("Hello world!");
```

在D3中，使用 **d3.select** 方法实现对单个元素的选取，然后用级联修饰函数对该选集的属性以及HTML进行操作。如果匹配多个元素，只返回第一个元素。


部分常见的修饰函数：

- selection.attr:读取或者改变元素上的给定属性

  ```js
  d3.select("p").attr("foo","goo")  //将p元素的foo属性设为goo
  d3.select("p").attr("foo")  //读取p元素的foo属性
  ```

- selection.classed : 用来添加、删除选定元素的css class

  ```js
  d3.select("p").classed("goo") //检测p元素是否有名为goo的class
  d3.select("p").classed("goo",true) //为p元素添加goo class
  d3.select("p").classed("goo",function(){return false}) //移除p元素上的goo class。classed方法也接受函数作为参数传入
  ```

- selection.style : 用来给选定的元素添加指定的样式

  ```js
  d3.select("p").style("font-size");//获取p元素的font-size
  d3.select("p").style("font-size","10px");//将font-size的值设为10px
  d3.select("p").style("font-size",function(){
    return normalFontSize+10;
  });//
  ```


- selection.text : 用来获取或设置选定元素的文本内容

  ```js
  d3.select("p").text();//获取p元素的文本内容
  d3.select("p").text("Hello"); //设置p元素的文本内容为Hello
  d3.select("p").text(function(){return "Hello"});
  ```

- selection.html : 用来更改元素内的HTML

  ```js
  d3.select("p").html();
  d3.select("p").text("<b>Hello</b>");
  ```

这些修饰函数可以用于单个元素以及多个元素。



### 2.选择多个元素

```html
<div></div>
<div></div>
<div></div>
```
```js
d3.selectAll('div')
  .attr("class","red box")
```
  上面的代码中，d3.selectAll函数选择所有的div元素。


### 3.迭代选集中的元素

有时候，我们需要遍历选集中的所有元素，再根据它们的不同位置分别进行不同的处理。我们可以用D3的选集迭代API来实现。

```html
<div></div>
<div></div>
<div></div>
```

```js
d3.selectAll('div')
  .attr("class","red box")
  .each(function(d,i){
    d3.select(this).append("h1").text(i)
  })
```


**selection.each(function)函数：** each函数接受迭代函数作为其参数传入，给定的迭代函数接受两个可选的参数d和i，以及一个隐含的参数this,this为指向当前DOM元素的引用。第一个参数d表示这个元素的数据绑定。第二个参数i指当前迭代元素再整个选集中的索引值。所以只从0开始。

**selection.append(name)函数：** 负责创建一个名为传入参数的新元素，并将其附加为当前选集的最后一个元素，然后返回包含新添加元素的选集。
  
  >> 其他资料解释，append函数，是在被选元素的结尾(仍然在内部)，插入指定的内容。


### 4.使用子选择器

### 5.函数级联调用

### 6.处理原始选集


## 第3章 与数据同行

### 1.将数组绑定为数据

```js
var data = [10,15,30,50,80,65,55,30,20,10,8];

function render(){
  //enter
  d3.select('body').selectAll('div.h-bar')
    .data(data)
    .enter()
    .append('div')
      .attr('class',"h-bar")
        .append("span");

    //update
    d3.select('body').selectAll('div.h-bar')
      .data(data)
      .style("width",function(d){
        return (d*3)+'px';
      })
      .select("span")
      .text(function(d){
        return d
      })

    //exit
    d3.select('body').selectAll('div.h-bar')
      .data(data)
      .exit()
        .remove();

    setInterval(function(){
      data.shift();
      data.push(Math.round(Math.random()*100));
      render(data);
    },1500)

    render(data);
}
```




